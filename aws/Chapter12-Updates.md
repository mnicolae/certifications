# SQS Delay Queues & Large Messages

##  SQS Delay Queue

* Postpone delivery of new messages
* Messages in Delay Queue remain invisible for the duration of the delay period (0 - 900s)
* Large distributed applications which may need to introduce a delay in processing

## Managing Large Messages in S3

* Store large messages - 256KB - 2GB in S3
* AWS SDK for Java
* Amazon SQS Extended Client Library for Java
* Cannot use: AWS CLI, Management Console / SQS Console, SQS API

# AWS CLI Pagination

* If you do see errors like "timed out", or errors related to too many results being returned adjust the pagination of CLI results to avoid errors generated by too many results.
* The CLI still retrieves the full list, but performs a larger number of API calls in the background and retrieves a smaller number of items with each call.

# IAM Policy Simulator

* Test IAM permissions before you commit them to production.
* Validate that the policy works as expected.
* You can also test policies attached to existing users - great for troubleshooting.

# Kinesis Shards vs Consumers

* The Kinesis Client Library running on your consumers creates a record processor for each shard that is being consumed by your instance.
* If you increase the number of shards, the KCL will add more record processors on your consumers.
* CPU utilization is what should drive the quantity of consumer instances you have, NOT the number of shards in your Kinesis stream.
* Use an Auto Scaling group, and base scaling decisions on CPU load on your consumers.

# Lambda Concurrent Executions Limit

* Know that a limit exists - 1,000 concurrent executions per second
* If you are running a serverless website like ACG, it's likely you will hit the limit at some point
* If you hit the limit you will start to see invocations being rejected - 429 HTTP status code
* The remedy is to get the limit increased by AWS support
* *Reserved concurrency* guarantees a set number of concurrent executions are always available to a critical function

# Lambda Versions

* $LATEST is always the last version of code you uploaded to Lambda
* Use Lambda Versioning and Aliases to point your application to a specific version if you don't want to use $LATEST
* If you application uses an alias, instead of $LATEST remember that it will not automatically use new code when you upload it.

# Lambda and VPCs

* It is possible to enable Lambda to access resources which are inside a private VPC.
* Provide VPC config to the function - private subnet ID, security group ID.
* Lambda uses the VPC information to set up ENIs using an IP from the private subnet CIDR range.
* The security group then allows your function to access resources in VPC.

# X-Ray Configuration

* X-Ray integrates with many AWS services like DynamoDB, Lambda, API Gateway, etc.
* You can also instrument your own applications to send data to X-Ray.
* Applications can be running on EC2, Elastic Beanstalk environments, on-premises systems and ECS.
* For ECS, run the X-Ray daemon in its own Docker image, running alongside your application.

* You'll need three things:
* X-Ray SDK
* X-Ray daemon
* Instrument your application using the SDK to send the required data to X-Ray, e.g., data about incoming HTTP requests to your application
* If you want to also record application specific information in the form of key-value pairs, use annotations to add user defined key-value pairs to your X-Ray data - allows you to filter, index and search within X-Ray, e.g., `game_name=TicTacToe,game_id=2645445842`

# Deploying Docker using Elastic Beanstalk

* When using Elastic Beanstalk, you can deploy your Docker container to a single EC2 instance.
* You can also deploy multiple Docker instances to an ECS cluster.
* To deploy a Docker application just upload your code bundle to Elastic Beanstalk.
* To upgrade your application to a new version, it's one easy step in the console to upload and deploy your new version.
* You can also store your code in CodeCommit - but you must use the Elastic Beanstalk CLI.

# Additional resources

1. Official AWS FAQs
2. Whitepapers
3. re:Invent Videos

## Whitepapers

* Practicing CI/CD on AWS
* Introduction to DevOps on AWS
* Blue/Green Deployments on AWS
* Serverless Architectures with Lambda
* Docker on AWS: Running Containers in the Cloud
* Running Containerized Microservices in AWS
* Optimizing Enterprise Economics with Serverless Architectures
* AWS Security Best Practices

## Getting the Most Out of Whitepapers

1. Browse the entire document
2. Revisit only the sections worth reading
3. Keep in mind what to expect to get out of it
4. Take notes
